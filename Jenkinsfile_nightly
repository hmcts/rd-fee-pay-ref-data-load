#!groovy

properties([
  // H allow predefined but random minute see https://en.wikipedia.org/wiki/Cron#Non-standard_characters
  pipelineTriggers([cron('H 05 * * *')])
])

@Library("Infrastructure")

def type = "java"
def product = "rd"
def component = "location-ref-data-load"

GradleBuilder builder = new GradleBuilder(this, product)

withNightlyPipeline(type, product, component) {
  after('securityScan') {
    echo "Just waiting a while to ensure that the pod has run the job"
    def time = "120"
    echo "Waiting ${time} seconds for deployment to complete prior starting functional testing"
    sleep time.toInteger() // seconds
    try {
      builder.gradle('functional')
    } finally {
      junit '**/test-results/**/*.xml'
    }
  }
}
